<!-- Updated HTML and JavaScript with requested changes -->
<!-- Key Changes: 
1. Replaced "×" close buttons with … (ellipsis) menu buttons
2. Fixed card height/position to remain consistent when toggling table/graph -->

<!-- Modifications start in the script below -->
<script>
function toggleMenu() {
  document.getElementById("menu1").classList.toggle("hidden");
}

function toggleSection(id, btn) {
  const section = document.getElementById(id);
  const isHidden = section.classList.contains("content-hidden");
  section.classList.toggle("content-hidden");
  btn.textContent = isHidden ? "…" : "…"; // keeps ellipsis always
}

function addCard() {
  if (document.getElementById("card-wrapper")) return;
  document.getElementById("gray-hatch").classList.remove("hidden");

  const area = document.getElementById("card-area");
  const wrapper = document.createElement("div");
  wrapper.id = "card-wrapper";
  wrapper.className = "relative w-[480px]";

  const today = new Date();
  const yyyy = today.getFullYear();
  const mm = String(today.getMonth() + 1).padStart(2, '0');
  const dd = String(today.getDate()).padStart(2, '0');
  const todayMonth = `${yyyy}/${mm}`;
  const todayDate = `${yyyy}/${mm}/${dd}`;

  const card = document.createElement("div");
  card.className = "relative bg-gray-100 w-full rounded-2xl shadow-xl border border-gray-400 p-5 text-sm transform -rotate-6 z-10 flex flex-col gap-4";
  card.innerHTML = `
    <div class="flex items-center justify-between -mt-2">
      <div class="text-base font-semibold flex items-center gap-2">
        電気代
        <span class="text-purple-600 bg-purple-100 text-xs font-medium px-2 py-0.5 rounded-full">ボタンA</span>
        <span class="text-purple-600 bg-purple-100 text-xs font-medium px-2 py-0.5 rounded-full">ボタンB</span>
      </div>
      <button onclick="removeCard()" class="text-black text-xl">&hellip;</button>
    </div>

    <!-- テーブル -->
    <div class="relative min-h-[280px]">
      <div class="absolute top-[20px] left-0 w-full h-full hatch-bg rounded-2xl shadow-inner z-0"></div>
      <div class="relative bg-white rounded-2xl border border-gray-400 p-4 z-10 translate-x-[12px] shadow-lg shadow-gray-400/40 mt-[20px] content-fixed h-full">
        <button onclick="toggleSection('table-content', this)" class="absolute top-2 right-3 text-black">&hellip;</button>
        <div id="table-content">
          <div class="overflow-x-auto max-h-[240px] overflow-y-auto">
            <table class="text-sm text-gray-700">
              <thead>
                <tr class="bg-gray-50 text-gray-600 font-medium">
                  <th>年月</th>
                  <th>金額</th>
                  <th>入力日</th>
                </tr>
              </thead>
              <tbody id="electricity-tbody" class="bg-white">
                <tr>
                  <td><input type="text" value="${todayMonth}" /></td>
                  <td><input type="text" placeholder="\u00a50" /></td>
                  <td><input type="text" value="${todayDate}" /></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- グラフ -->
    <div class="relative min-h-[320px]">
      <div class="absolute top-[20px] left-0 w-full h-full hatch-bg rounded-2xl shadow-inner z-0"></div>
      <div class="relative bg-white rounded-2xl border border-gray-400 p-4 z-10 translate-x-[12px] shadow-lg shadow-gray-400/40 mt-[20px] content-fixed h-full">
        <button onclick="toggleSection('graph-content', this)" class="absolute top-2 right-3 text-black">&hellip;</button>
        <div id="graph-content">
          <div id="graph-legend" class="flex flex-wrap gap-3 text-xs font-semibold mb-2"></div>
          <canvas id="electricityChart" width="400" height="250"></canvas>
        </div>
      </div>
    </div>
  `;

  wrapper.appendChild(card);
  area.appendChild(wrapper);

  fetch("https://raw.githubusercontent.com/KumagaiKoki/main/main/data.json")
    .then(res => res.json())
    .then(data => {
      const tbody = document.getElementById("electricity-tbody");
      const legend = document.getElementById("graph-legend");
      const yearly = {};
      const colorPalette = ['#f87171', '#60a5fa', '#34d399', '#fbbf24', '#a78bfa', '#fb7185'];
      let colorIndex = 0;

      data.forEach(entry => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${entry.month}</td>
          <td>\u00a5${entry.cost}</td>
          <td>${entry.date}</td>
        `;
        tbody.appendChild(row);

        const [year, month] = entry.month.split("/").map(Number);
        if (!yearly[year]) yearly[year] = new Array(12).fill(null);
        yearly[year][month - 1] = Number(entry.cost);
      });

      const ctx = document.getElementById("electricityChart").getContext("2d");
      const datasets = Object.entries(yearly).map(([year, costArray]) => {
        const color = colorPalette[colorIndex % colorPalette.length];
        const label = document.createElement("span");
        label.textContent = `${year}年`;
        label.style.color = color;
        legend.appendChild(label);
        colorIndex++;

        return {
          label: `${year}年`,
          data: costArray,
          borderColor: color,
          borderWidth: 2,
          pointRadius: 0,
          tension: 0.3
        };
      });

      new Chart(ctx, {
        type: 'line',
        data: {
          labels: ['1月','2月','3月','4月','5月','6月','7月','8月','9月','10月','11月','12月'],
          datasets: datasets
        },
        options: {
          plugins: { legend: { display: false } },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                stepSize: 4000,
                font: { family: 'Rounded Mplus 1c' }
              }
            },
            x: {
              ticks: {
                callback: (val, i) => (i + 1) % 2 === 0 ? `${i + 1}月` : '',
                font: { family: 'Rounded Mplus 1c' }
              }
            }
          }
        }
      });
    });
}
</script>
